{"ast":null,"code":"import _slicedToArray from\"/home/alan/Delivery/DevResp/Previously_On/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useLocation}from\"react-router-dom\";import axios from\"axios\";import AuthService from\"../../services/auth-service\";import{Link}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function ShowDetail(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var user=AuthService.getCurrentUser();var _useLocation=useLocation(),state=_useLocation.state;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),showDetails=_useState4[0],setShowDetails=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),addShowMsg=_useState6[0],setAddShowMsg=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),episodes=_useState8[0],setEpisodes=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),marked=_useState10[0],setMarked=_useState10[1];useEffect(function(){var mounted=true;axios.get(\"https://api.betaseries.com/shows/display\",{params:{client_id:\"22f661bdce5c\",id:state}}).then(function(res){if(mounted){setShowDetails(res.data.show);setLoading(false);}}).catch(function(error){console.log(error.response);});return function cleanup(){mounted=false;};},[]);var addShowToUser=function addShowToUser(e){e.preventDefault();axios.post(\"https://api.betaseries.com/shows/show\",{client_id:\"22f661bdce5c\",token:user.token,id:state}).then(function(res){setAddShowMsg(\"Ajouté à votre liste !\");}).catch(function(error){setAddShowMsg(\"Vous suivez déjà cette serie...\");console.log(error.response);});};var removeShowToUser=function removeShowToUser(e){e.preventDefault();axios.delete(\"https://api.betaseries.com/shows/show\",{params:{client_id:\"22f661bdce5c\",token:user.token,id:state}}).then(function(res){setAddShowMsg(\"Série retirée de votre liste !\");}).catch(function(error){setAddShowMsg(\"Vous ne suivez pas serie...\");console.log(error.response);});};var displayEpisodes=function displayEpisodes(e){e.preventDefault();/*\n        axios.get(\"https://api.betaseries.com/episodes/list\", {\n            params: {\n                client_id: \"22f661bdce5c\",\n                token: user.token,\n                userId: user.user.id,\n                showId: state\n            }\n        }).then(res => {\n            setEpisodes(res.data.shows[0].unseen);\n            console.log(res.data.shows[0].unseen);\n        }).catch(error => {\n            console.log(error.response);\n        })\n        */axios.get(\"https://api.betaseries.com/shows/episodes\",{params:{client_id:\"22f661bdce5c\",id:state,token:user.token}}).then(function(res){//console.log(res.data.episodes);\nsetEpisodes(res.data.episodes);if(res.data.episodes.user.seen){setMarked(false);}else{setMarked(true);}}).catch(function(error){console.log(error.response);});};var markAsSeen=function markAsSeen(idEpisode){axios.post(\"https://api.betaseries.com/episodes/watched\",{bulk:true,client_id:\"22f661bdce5c\",token:user.token,delete:true,id:idEpisode}).then(function(res){}).catch(function(error){console.log(error.response);});};var markAsUnseen=function markAsUnseen(idEpisode){axios.delete(\"https://api.betaseries.com/episodes/watched\",{params:{client_id:\"22f661bdce5c\",token:user.token,id:idEpisode}}).then(function(res){}).catch(function(error){console.log(error.response);});};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto mt-28 text-white\",children:[loading?/*#__PURE__*/_jsx(\"p\",{className:\"text-center mx-auto text-2xl font-cabin mt-28 uppercase font-bold\",children:\"Chargement des informations...\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-5 gap-20 text-xl\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-1 text-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-7\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Genre\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-base text-gray-400\",children:Object.values(showDetails.genres).join(\", \")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-7\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Saisons\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-base text-gray-400\",children:showDetails.seasons})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-7\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Episodes\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-base text-gray-400\",children:showDetails.episodes})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-7\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Dur\\xE9e des \\xE9pisodes\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-base text-gray-400\",children:[showDetails.length,\" min\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-7\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Note\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-base text-gray-400\",children:[Math.round(showDetails.notes.mean),\"/5\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-7\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Archiver / Retirer la s\\xE9rie\"}),/*#__PURE__*/_jsx(\"button\",{onClick:addShowToUser,className:\"text-base text-gray-400 text-4xl mt-3\",children:/*#__PURE__*/_jsx(\"span\",{className:\"border px-3 pb-1\",children:\"+\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:removeShowToUser,className:\"text-base text-gray-400 text-4xl ml-6 mt-3\",children:/*#__PURE__*/_jsx(\"span\",{className:\"border px-4 pb-1\",children:\"-\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-400 italic text-sm mt-3\",children:addShowMsg})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-2\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-right -mt-12 text-yellow-400 font-roboto text-2xl uppercase font-bold\",children:/*#__PURE__*/_jsx(\"span\",{className:\"p-2 bg-gray-700 rounded-xl filter contrast-150 bg-opacity-80\",children:showDetails.title})}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-4\",children:[\"R\\xE9sum\\xE9 : \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),showDetails.description]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-span-2\",children:/*#__PURE__*/_jsx(\"img\",{className:\"-mt-10 w-10/12 float-right\",src:showDetails.images.poster,alt:\"Affiche\"})})]}),loading?/*#__PURE__*/_jsx(\"p\",{}):/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto mt-36 mb-9\",children:[/*#__PURE__*/_jsx(\"h2\",{onClick:displayEpisodes,className:\"cursor-pointer text-center -mt-12 text-yellow-400 font-roboto text-2xl uppercase font-bold\",children:/*#__PURE__*/_jsx(\"span\",{className:\"p-2 bg-gray-700 rounded-xl filter contrast-150 bg-opacity-80\",children:\"Episodes \\u25BC\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-7 gap-12 mt-12\",children:episodes.map(function(data){return/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-1\",children:[data.user.seen&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{to:{pathname:'/episode/details',state:data.id},children:/*#__PURE__*/_jsx(\"img\",{className:\"cursor-pointer\",src:'https://api.betaseries.com/pictures/episodes?id='+data.id+'&client_id=22f661bdce5c',alt:\"Affiche episode\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-center font-roboto mt-2\",children:data.code}),/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(e){markAsUnseen(data.id);displayEpisodes(e);},className:\"text-red-300 cursor-pointer underline text-sm text-center -mt-1\",children:\"marquer comme non-vu\"})]}),!data.user.seen&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{to:{pathname:'/episode/details',state:data.id},children:/*#__PURE__*/_jsx(\"img\",{className:\"cursor-pointer filter blur\",src:'https://api.betaseries.com/pictures/episodes?id='+data.id+'&client_id=22f661bdce5c',alt:\"Affiche episode\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-center font-roboto mt-2\",children:data.code}),/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(e){markAsSeen(data.id);displayEpisodes(e);},className:\"text-gray-400 cursor-pointer underline text-sm text-center -mt-1\",children:\"marquer comme vu\"})]})]});})})]})]})});}","map":{"version":3,"sources":["/home/alan/Delivery/DevResp/Previously_On/src/components/showDetail/showDetail.js"],"names":["React","useState","useEffect","useLocation","axios","AuthService","Link","ShowDetail","loading","setLoading","user","getCurrentUser","state","showDetails","setShowDetails","addShowMsg","setAddShowMsg","episodes","setEpisodes","marked","setMarked","mounted","get","params","client_id","id","then","res","data","show","catch","error","console","log","response","cleanup","addShowToUser","e","preventDefault","post","token","removeShowToUser","delete","displayEpisodes","seen","markAsSeen","idEpisode","bulk","markAsUnseen","Object","values","genres","join","seasons","length","Math","round","notes","mean","title","description","images","poster","map","pathname","code"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport axios from \"axios\";\nimport AuthService from \"../../services/auth-service\";\nimport { Link } from \"react-router-dom\";\n\nexport default function ShowDetail() {\n\n    const [loading, setLoading] = useState(true);\n    const user = AuthService.getCurrentUser();\n\n    const { state } = useLocation();\n\n    const [showDetails, setShowDetails] = useState([]);\n    const [addShowMsg, setAddShowMsg] = useState(\"\");\n    const [episodes, setEpisodes] = useState([]);\n    const [marked, setMarked] = useState(false);\n    \n\n    useEffect(() => {\n        \n        let mounted = true;\n        axios.get(\"https://api.betaseries.com/shows/display\", {\n            params: {\n                client_id: \"22f661bdce5c\",\n                id: state\n            }\n        }).then(res => {\n            if (mounted) {\n                setShowDetails(res.data.show);\n                setLoading(false);\n            }\n        }).catch(error => {\n            console.log(error.response);\n        })\n\n        return function cleanup() {\n            mounted = false;\n        }\n\n    }, [])\n\n    const addShowToUser = (e) => {\n        e.preventDefault();\n        axios.post(\"https://api.betaseries.com/shows/show\", {\n            client_id: \"22f661bdce5c\",\n            token: user.token,\n            id: state\n        }).then(res => {\n            setAddShowMsg(\"Ajouté à votre liste !\");\n        }).catch(error => {\n            setAddShowMsg(\"Vous suivez déjà cette serie...\");\n            console.log(error.response);\n        })\n    }\n\n    const removeShowToUser = (e) => {\n        e.preventDefault();\n        axios.delete(\"https://api.betaseries.com/shows/show\", {\n            params: {\n                client_id: \"22f661bdce5c\",\n                token: user.token,\n                id: state\n            }\n        }).then(res => {\n            setAddShowMsg(\"Série retirée de votre liste !\");\n        }).catch(error => {\n            setAddShowMsg(\"Vous ne suivez pas serie...\");\n            console.log(error.response);\n        })\n    }\n\n    const displayEpisodes = (e) => {\n        e.preventDefault();\n        /*\n        axios.get(\"https://api.betaseries.com/episodes/list\", {\n            params: {\n                client_id: \"22f661bdce5c\",\n                token: user.token,\n                userId: user.user.id,\n                showId: state\n            }\n        }).then(res => {\n            setEpisodes(res.data.shows[0].unseen);\n            console.log(res.data.shows[0].unseen);\n        }).catch(error => {\n            console.log(error.response);\n        })\n        */\n        axios.get(\"https://api.betaseries.com/shows/episodes\", {\n            params: {\n                client_id: \"22f661bdce5c\",\n                id: state,\n                token: user.token\n            }\n        }).then(res => {\n            //console.log(res.data.episodes);\n            setEpisodes(res.data.episodes);\n            if (res.data.episodes.user.seen) {\n                setMarked(false);\n            } else {\n                setMarked(true);\n            }\n        }).catch(error => {\n            console.log(error.response);\n        })\n    }\n\n    const markAsSeen = (idEpisode) => {\n        axios.post(\"https://api.betaseries.com/episodes/watched\", {\n            bulk: true,\n            client_id: \"22f661bdce5c\",\n            token: user.token,\n            delete: true,\n            id: idEpisode\n        }).then(res => {\n        }).catch(error => {\n            console.log(error.response);\n        })\n    }\n\n    const markAsUnseen = (idEpisode) => {\n        axios.delete(\"https://api.betaseries.com/episodes/watched\", {\n            params: {\n                client_id: \"22f661bdce5c\",\n                token: user.token,\n                id: idEpisode\n            }\n        }).then(res => {\n\n        }).catch(error => {\n            console.log(error.response);\n        })\n    }\n\n\n    return(\n        <>\n        <div className=\"container mx-auto mt-28 text-white\">\n            {loading ? <p className=\"text-center mx-auto text-2xl font-cabin mt-28 uppercase font-bold\">Chargement des informations...</p> :\n            <div className=\"grid grid-cols-5 gap-20 text-xl\">\n                <div className=\"col-span-1 text-right\">\n                    <div className=\"mb-7\">\n                        <p>Genre</p>\n                        <p className=\"text-base text-gray-400\">{Object.values(showDetails.genres).join(\", \")}</p>\n                    </div>\n                    <div className=\"mb-7\">\n                        <p>Saisons</p>\n                        <p className=\"text-base text-gray-400\">{showDetails.seasons}</p>\n                    </div>\n                    <div className=\"mb-7\">\n                        <p>Episodes</p>\n                        <p className=\"text-base text-gray-400\">{showDetails.episodes}</p>\n                    </div>\n                    <div className=\"mb-7\">\n                        <p>Durée des épisodes</p>\n                        <p className=\"text-base text-gray-400\">{showDetails.length} min</p>\n                    </div>\n                    <div className=\"mb-7\">\n                        <p>Note</p>\n                        <p className=\"text-base text-gray-400\">{Math.round(showDetails.notes.mean)}/5</p>\n                    </div>\n                    <div className=\"mb-7\">\n                        <p>Archiver / Retirer la série</p>\n                        <button onClick={addShowToUser} className=\"text-base text-gray-400 text-4xl mt-3\"><span className=\"border px-3 pb-1\">+</span></button>\n                        <button onClick={removeShowToUser} className=\"text-base text-gray-400 text-4xl ml-6 mt-3\"><span className=\"border px-4 pb-1\">-</span></button>\n                        <p className=\"text-red-400 italic text-sm mt-3\">{addShowMsg}</p>\n                    </div>\n                </div>\n                <div className=\"col-span-2\">\n                    <h2 className=\"text-right -mt-12 text-yellow-400 font-roboto text-2xl uppercase font-bold\"><span className=\"p-2 bg-gray-700 rounded-xl filter contrast-150 bg-opacity-80\">{showDetails.title}</span></h2>\n                    <p className=\"mt-4\">Résumé : <br /><br /> \n                    {showDetails.description}\n                    </p>\n                </div>\n                <div className=\"col-span-2\">\n                    <img className=\"-mt-10 w-10/12 float-right\" src={showDetails.images.poster} alt=\"Affiche\" />\n                </div>\n            </div>\n            }\n        {loading ? <p></p> :\n            <div className=\"container mx-auto mt-36 mb-9\">\n                <h2 onClick={displayEpisodes} className=\"cursor-pointer text-center -mt-12 text-yellow-400 font-roboto text-2xl uppercase font-bold\"><span className=\"p-2 bg-gray-700 rounded-xl filter contrast-150 bg-opacity-80\">Episodes &#9660;</span></h2>\n                <div className=\"grid grid-cols-7 gap-12 mt-12\">\n                    {episodes.map(function(data) {\n                        return (\n                            <div className=\"col-span-1\">\n                                {data.user.seen &&\n                                <>\n                                    <Link to={{pathname: '/episode/details', state: data.id}}><img className=\"cursor-pointer\" src={'https://api.betaseries.com/pictures/episodes?id=' + data.id + '&client_id=22f661bdce5c'} alt=\"Affiche episode\" /></Link>\n                                    <p className=\"text-center font-roboto mt-2\">{data.code}</p>\n                                    <p onClick={(e) => {markAsUnseen(data.id);displayEpisodes(e)}} className=\"text-red-300 cursor-pointer underline text-sm text-center -mt-1\">marquer comme non-vu</p>\n                                </>\n                                }\n                                {!data.user.seen &&\n                                <>\n                                    <Link to={{pathname: '/episode/details', state: data.id}}><img className=\"cursor-pointer filter blur\" src={'https://api.betaseries.com/pictures/episodes?id=' + data.id + '&client_id=22f661bdce5c'} alt=\"Affiche episode\" /></Link>\n                                    <p className=\"text-center font-roboto mt-2\">{data.code}</p>\n                                    <p onClick={(e) => {markAsSeen(data.id);displayEpisodes(e)}} className=\"text-gray-400 cursor-pointer underline text-sm text-center -mt-1\">marquer comme vu</p>\n                                </>\n                                }\n                            </div>\n                        )\n                    })}\n                </div>\n            </div>\n        }\n        </div>\n        </>\n    )\n}"]},"metadata":{},"sourceType":"module"}